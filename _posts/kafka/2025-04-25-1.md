---
title: "아파치 카프카 (apache kafka) 기초 개념 정리"
excerpt: ""

categories:
  - 카프카
tags:
  - []

permalink: /kafka/2025-04-25-1

toc: true
toc_sticky: true
 
date: 2025-04-25
last_modified_at: 2025-04-25
---

카프카 프로젝트 분석을 위해서 학습한 내용을 정리한 글입니다.

---

## 카프카 기초 개념

### 카프카란?
링크드인에 데이터를 생성하는 소스 애플리케이션, 데이터를 적재하는 타깃 애플리케이션이 늘어나면서  
아키텍처가 복잡해짐에 따라 데이터 파이프라인의 복잡도를 낮추기 위해 개발된 오픈소스입니다.  
현재는 Apache 재단에서 관리하는 오픈소스이므로 아파치 카프카라고 불리고 있습니다.

카프카라는 중앙 메시지 허브를 두고, 모든 애플리케이션이 카프카를 통해 메시지를 주고 받습니다.

<mark>카프카 장점</mark>
- 데이터를 배치로 묶어서 주고 받기 때문에, 네트워크 통신 횟수를 줄이고 많은 양의 데이터 전송 가능
- 데이터 요청 수가 가변적인 환경에서 안정적으로 확장 가능 (클러스터 내 브로커 수를 늘려서 스케일아웃)
- 전송받은 데이터를 메모리가 아닌 파일 디스크에 로그 세그먼트 단위로 저장해서 재시작 시 데이터가 보존되는 영속성
- 프로듀서가 보낸 데이터를 각 브로커에 파티션을 복제 저장하여 브로커 장애 시에도 지속적 데이터 처리 가능 (고가용성)
- 데이터 로그 시간을 기반으로 Kafka Streams, ksqlDB 등을 이용해 구체화 뷰(Materialized view)를 생성해서 배치 데이터 처리 가능
- 스트리밍 데이터를 저장하고 처리하는 플랫폼 역할 가능
- 프로듀서 전송량이 많아지면 파티션, 컨슈머 수를 늘려서 병렬 처리량 높이고 컨슈머 렉 (지연) 완화 가능

### 카프카 용어
- 클러스터 : 카프카 시스템 (카프카 브로커 서버 집합)
- 주키퍼 : 카프카 3.0 버전 이하 클러스터 실행을 위해 반드시 필요한 애플리케이션
- 브로커 : 프로듀서에서 데이터를 받아서 복제 저장하고, 컨슈머로 데이터를 보내는 서버 (클러스터당 브로커 3대 운영이 일반적. 데이터량이 많은 경우 50~100대도 가능)
- 컨트롤러 : 다른 브로커 상태 체크, 클러스터에서 빠질 장애 브로커 리더 파티션을 재분배하는 역할의 브로커
- 프로듀서 : 브로커에 데이터 보내는 역할
- 커넥트(소스) : DB, S3 등에서 데이터를 가져와서 토픽에 넣는 프로듀서 역할
- 컨슈머 : 브로커에서 토픽 데이터 가져가는 역할. 데이터 가져가도 삭제되지 않음
- 커넥트(싱크) : 토픽 데이터를 JDBC, Elasticsearch 등으로 보내는 컨슈머 역할
- 토픽 : 데이터 구분. RDBMS의 테이블 개념. 토픽명은 영어, 숫자, 하이픈 사용 권장. 토픽 이름 변경 불가
- 세그먼트 : 파티션을 나눈 로그 파일 단위. 토픽 데이터 삭제는 로그 세그먼트 단위로 브로커만 가능
- 파티션 : 데이터가 저장 및 복제되는 토픽 내부 단위. 1~1000개 자유롭게 생성 가능. 파티션당 최대 1개의 컨슈머만 처리 가능. 한번 늘린 파티션 개수를 줄이는 것은 불가능하므로 신중하게 늘려야 함
- 오프셋 : 브로커가 부여하는 파티션 별 메시지 순번. 처리 완료 데이터, 앞으로 처리할 데이터 구분 용도로 사용하여 중복 처리 방지
- 메시지(=레코드) : 카프카에서 주고 받는 데이터 조각. 오프셋, 메시지 키, 메시지 값(JSON, 문자열, 바이너리 등), 헤더, 타임스탬프로 이루어져 있음. 수정 불가
- 오프셋 커밋 : 컨슈머가 몇 번 오프셋 데이터까지 읽었는지 __consumer_offsets 토픽에 자동 저장하는 것
- Streams : 토픽에 있는 데이터를 처리하고 다시 토픽으로 넣는 역할
- 리밸런스 : 장애 컨슈머가 컨슈머 그룹에서 빠지면 매칭되지 않은 파티션을 다른 컨슈머로 할당하는 과정

<mark>카프카 파티션 관련 용어</mark>
- 리더 파티션 : 프로듀서, 컨슈머와 통신하는 브로커의 파티션
- 팔로워 파티션 : 리더 파티션을 가진 브로커가 아닌, 다른 브로커들의 복제된 파티션 (데이터 복제용이며, 프로듀서, 컨슈머와 직접 통신 불가)
- ISR (In-Sync-Replicas) : 리더 파티션, 팔로워 파티션들이 싱크되어 오프셋 수가 동일한 상태

---
title: "Java 카프카 스트림즈, 카프카 커넥트 개발 방법"
excerpt: ""

categories:
  - Kafka
tags:
  - []

permalink: /kafka/2025-05-12-1

toc: true
toc_sticky: true

date: 2025-05-12
last_modified_at: 2025-05-12
---

## 카프카 스트림즈

사용할 소스 토픽, 저장할 싱크 토픽이 같은 경우 스트림즈를 이용해 스트림 데이터를 처리할 수 있습니다.

처리할 토픽 파티션이 3개면 스트림즈 애플리케이션 내부에 3개의 테스트가 자동으로 생깁니다.  
동일한 애플리케이션 ID로 여러 스트림즈 애플리케이션을 실행하여 프로세스-스레드를 분리하면,  
일부 프로세스에 장애가 발생해도 안정적인 운영이 가능합니다.

<mark>스트림즈 프로세서 종류</mark>
- 소스 프로세서 : 토픽에서 데이터를 가져오는 역할
- 스트림즈 프로세서 : 다른 프로세서가 반환한 데이터를 처리하는 역할
- 싱크 프로세서 : 처리가 완료된 데이터를 다른 토픽에 저장하는 역할

### 스트림즈DSL
스트림즈 애플리케이션 개발 시 주로 사용되는 API입니다.  
메시지 값을 기반으로 토픽 분기, 지난 10분간 들어온 데이터 수 집계 등이 가능합니다.

<mark>KStream</mark>
컨슈머로 토픽을 구독하는 것처럼, 실시간 스트림 데이터를 하나씩 처리하는 방식입니다.

<mark>KTable</mark>
메시지 키를 기준으로 가장 최신 레코드만 유지합니다.

<mark>GlobalKTable</mark>
스트림즈 애플리케이션의 각 태스크에서 MaterialzedView (구체화된 뷰) 로 사용됩니다.  
전체 파티션 데이터에 전역 접근할 수 있습니다.

### 프로세서 API
스트림즈 애플리케이션 개발 시 스트림즈DSL보다 세밀한 로직 구현이 가능한 API입니다.  
스트림즈DSL과 함께 사용하면 KStream, KTable, GlobalKTable 개념과 연동할 수 있습니다.  
메시지 값 종류에 따라 동적으로 토픽 전송, 일정한 시간 간격으로 데이터 처리 등이 가능합니다.

<mark>Processor 인터페이스</mark>
입력 데이터 처리 후 다음 프로세서로 데이터를 자동 전달하지 않고 직접 제어할 때 사용합니다.  
ProcessorContext를 이용하면 필요한 시점에만 데이터를 전달할 수 있습니다.
```
public class FilterProcessor implements Processor<String, String> { // 메시지 키, 메시지 값 타입 지정
  private ProcessorContext context;

  @Override
  public void init(ProcessorContext context) {
    // 컨텍스트 초기화
    this.context = context;
  }

  @Override
  public void process(String key, String value) {
    if (value.length() > 5) {
      // 컨텍스트 이용해서 다음 프로세서로 데이터 전달
      context.forward(key, value);
    }

    // 오프셋 커밋 (필요 시 호출)
    context.commit();
  }

  @Override
  public void close() {
    // 리소스 해제 처리
  }
}
```
위와 같이 Processor 인터페이스 구현 후, 아래와 같이 스트림 프로세서로 지정하면 됩니다.
```
// 토폴로지 생성
Topology topology = new Topology();

// 소스 프로세서, 스트림 프로세서, 싱크 프로세서 지정
topology.addSource("Source", 소스토픽명)
        .addProcessor("Process",
                      () -> new FilterProcessor(),
                      "Source")
        .addSink("Sink", 싱크토픽명, "Process");

// 카프카 스트림즈 인스턴스 생성
KafkaStreams streaming = new KafkaStreams(topology, props);

// 스트림즈 애플리케이션 실행
streaming.start();
```

<mark>Transformer 인터페이스</mark>  
입력 데이터 처리 후 다음 프로세서로 데이터를 전달할 때 사용합니다.

---

## 카프카 커넥트

작성예정

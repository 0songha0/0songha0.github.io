---
title: "리눅스 톰캣 WAR 수동 배포 방법 / 개발서버, 운영서버 반영 방법"
excerpt: ""

categories:
  - 운영 / 리눅스
tags:
  - []

permalink: /op/2023-11-27-1

toc: true
toc_sticky: true

date: 2023-11-27
last_modified_at: 2023-11-27
---

## 개발서버 WAR 수동 배포 방법

개발서버는 어드민, 사용자 서비스가 한 프로젝트에 있는 경우라면, 하나의 톰캣에 단일 war로 올려도 좋습니다.

### ROOT 계정으로 전환
```bash
sudo su -
```
별도의 설정을 하지 않았다면, 톰캣 실행은 root 계정으로만 가능하니 미리 계정을 변경합니다.

### 기존 소스 백업
파일질라로 /톰캣경로/webapps 폴더의 기존 프로젝트 소스를 node_modules처럼 무거운 폴더 제외하고 날짜 폴더에 내려받아서 백업하는 것이 좋습니다.

### 톰캣 종료
```bash
/톰캣경로/bin/shutdown.sh
```
톰캣 실행 중 webapps 폴더 안에 war를 올리면 자동으로 압축 해제되니 기존 실행중이던 톰캣 서비스를 종료합니다.

### 기존 프로젝트 소스, war 삭제
```bash
cd /톰캣경로/webapps
rm -rf ROOT또는프로젝트명/*
rm -rf ROOT또는프로젝트명.war
```
기존 프로젝트 폴더를 지우지 않으면 덮어씌워지는데, 삭제된 파일은 직접 삭제해야 하니 전체 삭제하고 진행하는 것이 좋습니다.  
기존 war 파일이 있다면, 같은 이름이라 업로드가 안될 수 있으니 삭제합니다.

### 파일질라로 war 업로드
<mark>war 파일 이름 변경</mark>
<table>
  <tbody>
    <tr>
      <td>톰캣 하나에 프로젝트 하나만 올리는 경우</td>
      <td>ROOT.war</td>
    </tr>
    <tr>
      <td>톰캣 하나에 여러 프로젝트 올리는 경우</td>
      <td>프로젝트명.war</td>
    </tr>
  </tbody>
</table>

<mark>war 업로드 경로</mark>
```
/톰캣경로/webapps
```

### war 압축 해제
```bash
unzip ROOT또는프로젝트명.war -d ROOT또는프로젝트명
```

### 톰캣 실행
```bash
cd /톰캣경로/bin
./startup.sh
```
톰캣 실행 시 war 파일이 압축 해제된 ROOT또는프로젝트 폴더 소스가 반영됩니다.

---

## 운영서버 WAR 수동 배포 방법

운영서버는 관리자, 사용자 서비스가 한 프로젝트에 있어도 두 개의 톰캣에 분리하여 각각의 war로 배포하는 것이 좋습니다.  
관리자 서비스에 문제가 있어도 사용자 서비스에 영향을 미치지 않게 하기 위함입니다.

대부분의 운영서버는 was 서버가 이중화되어 있기 때문에, 모든 was 서버의 톰캣에 동일하게 배포해야 합니다.  
모든 was 서버의 톰캣 로그를 열어두고, URL로 서비스 접속하여 어떤 톰캣에 붙었는 지 확인 후 그 서버 먼저 반영해서 테스트 시 정상이면 다른 서버들에 반영하는 것이 안전합니다.

root 계정이 아니면 운영서버 /톰캣경로/webapps 폴더에 접근할 수 없기 때문에 개발서버 배포와 절차가 다릅니다.

### ROOT 계정으로 전환
```bash
sudo su -
```
대부분의 권한이 root에 있기 때문에 계정을 전환합니다.

### 기존 소스 백업
<mark>백업용 폴더 생성</mark>
```bash
mkdir -p /home/유저명/bak/날짜/순번_메모
```

<mark>기존 프로젝트 소스 복사</mark>
```bash
cp -r /톰캣경로/webapps/ROOT또는프로젝트명/* /home/유저명/bak/날짜/순번_메모
```
프로젝트 크기가 크면 멈춘 것처럼 보일 수 있으나, 기다리면 정상적으로 복사 완료됩니다.  
로컬에 날짜 폴더 생성 후 내려받아서 백업합니다.

### 파일질라로 war 업로드
/home/유저명/deploy/날짜/순번_메모 폴더에 war 파일을 업로드합니다.

### 톰캣 종료
```bash
/톰캣경로/bin/shutdown.sh
```
톰캣 실행 중 webapps 폴더 안에 war를 올리면 자동으로 압축 해제되니 기존 실행중이던 톰캣 서비스를 종료합니다.  
첫 번째 was에 반영 후 정상 로그 확인 전까지는 두 번째 was를 내리면 절대 안됩니다.

### 기존 프로젝트 소스, war 삭제
```bash
cd /톰캣경로/webapps
rm -rf ROOT또는프로젝트명/*
rm -rf ROOT또는프로젝트명.war
```
기존 프로젝트 폴더를 지우지 않으면 덮어씌워지는데, 삭제된 파일은 직접 삭제해야 하니 전체 삭제하고 진행하는 것이 좋습니다.  
기존 war 파일이 있다면, 같은 이름이라 업로드가 안될 수 있으니 삭제합니다.

### 톰캣 폴더에 war 복사
```bash
cp /home/유저명/deploy/날짜/순번_메모/ROOT또는프로젝트명.war /톰캣경로/webapps
```

### war 압축 해제
```bash
unzip /톰캣경로/webapps/ROOT또는프로젝트명.war -d /톰캣경로/webapps/ROOT또는프로젝트명
```

### 톰캣 실행
```bash
cd /톰캣경로/bin
./startup.sh
```
톰캣 실행 시 war 파일이 압축 해제된 ROOT또는프로젝트 폴더 소스가 반영됩니다.

---

## 단건 수동 반영 방법

war 배포와 마찬가지로, 운영 반영 시에는 같은 경로 파일 백업 후 모든 was에 동일하게 반영해야 합니다.

### 프론트 파일 배포
css, js, jsp 등 프론트 파일은 /톰캣경로/webapps/프로젝트폴더명/wabapps 이하에서 /프로젝트폴더/src/main/webapp 이하와 같은 경로 파일을 교체하면, war 배포 및 톰캣 재실행 없이도 반영됩니다.

### Java Class 파일 배포
Java 컴파일 결과물인 Class 파일은 /톰캣경로/webapps/프로젝트폴더명/WEB-INF/classes 이하에서 /프로젝트폴더/src/main/java 이하와 같은 경로 파일을 교체하고 톰캣 재실행 시 반영됩니다.

---

## 백업한 프로젝트 소스 복구 방법
로컬에 백업했던 프로젝트 소스를 반디집으로 tar 압축 후 파일질라로 올리고,  
/톰캣경로/webapps 폴더에 옮긴 뒤 아래의 명령어로 압축을 풉니다.
```bash
mkdir ROOT또는프로젝트폴더명
tar -xvf ROOT또는프로젝트폴더명.tar -C ./ROOT또는프로젝트폴더명
```
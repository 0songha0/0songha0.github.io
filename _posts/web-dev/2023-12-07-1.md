---
title: "통합 SSO 로그인 연동 기능 소스 분석 / eGovframework 세션 로그인 방법 (작성중)"
excerpt: ""

categories:
  - 웹 개발
tags:
  - []

permalink: /web-dev/2023-12-07-1

toc: true
toc_sticky: true
 
date: 2023-04-27
last_modified_at: 2023-04-27
---

## 기존 SSO 로그인 소스 분석

### jsp에서 로그인 요청
유저가 입력한 아이디, 비밀번호가 담긴 Form을 파라미터로 ajax 호출하여 서버에 요청합니다.  
'아이디 저장' 체크박스 값이 checked이면 쿠키에 아이디를 저장합니다.

### 서버에서 로그인 처리
Controller에서 ajax 요청을 받고, LoginAPIUtil의 login 함수를 호출합니다.

LoginAPIUtil에서 SSO 로그인 API URL에 get 방식으로 아이디, 비밀번호를 담고, HttpURLConnection을 통해 요청합니다.  
json 형태로 받은 결과 값을 BufferedReader로 읽고 JSONParser로 파싱해서 리턴합니다.

다시 Controller에서 LoginAPIUtil 리턴 값으로 정상 로그인 체크 후 공통 함수를 호출합니다.

공통 함수에서 유저 테이블에서 유저 아이디로 유저 고유 ID를 조회합니다.  
조회 결과가 없으면 유저 고유 ID와 암호화 패스워드를 생성하여 세팅하고, 유저 테이블과 유저 권한 테이블(COMTNEMPLYRSCRTYESTBS)에 각각 insert 합니다.  
마지막으로, 유저 테이블에서 유저의 고유 ID로 유저 정보들을 조회하여 LoginVO에 담아 리턴합니다.

다시 Controller에서 LoginVO를 세션에 저장합니다.  
ModelAndView에 유저 token 값, 로그인 여부를 담아 JsonView로 리턴합니다.

### jsp 콜백 함수에서 후처리
<mark>ajax 요청 성공 시</mark>  
IE11이면 SSO 성공 URL에 get 방식으로 유저 토큰 값을 담고, script 태그의 src 값으로 설정한 뒤 head에 append 합니다.  
IE11이 아닌 브라우저이면 /cmmn/index.do 페이지로 URL을 이동합니다.

<mark>ajax 요청 실패 시</mark>  
'아이디/비밀번호를 다시 입력해 주세요.' 팝업을 띄웁니다.






암호화된 유저 토큰 값을 파라미터로 요청 받습니다.
3) 사내 통합 SSO 로그인 API를 호출합니다.
4) 로그인 성공 코드 체크
5) 로그인 성공 시에는 세션 로그인 처리하고 유저 정보를 쿠키에 저장 후 해당 유저 메인 화면으로 redirect 합니다.
6) 로그인 실패 시에는 로그인 화면으로 redirect 합니다.




## eGovframework 세션 로그인 방법

## eGovframework 쿠키 저장 방법
